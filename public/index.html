<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" />
    <title>Java Code Executor</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background-color: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #555;
      }
      textarea {
        width: 100%;
        height: 300px;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        resize: vertical;
        box-sizing: border-box;
      }
      textarea:focus {
        outline: none;
        border-color: #007bff;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
      }
      button:hover {
        background-color: #0056b3;
      }
      .example {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-top: 20px;
        border-left: 4px solid #007bff;
      }
      .example h3 {
        margin-top: 0;
        color: #007bff;
      }
      .example code {
        background-color: #e9ecef;
        padding: 2px 4px;
        border-radius: 2px;
        font-family: "Courier New", monospace;
      }
      .result-section {
        margin-bottom: 30px;
        padding: 20px;
        border-radius: 4px;
        border-left: 4px solid #007bff;
        background-color: #f8f9fa;
      }
      .error-section {
        border-left-color: #dc3545;
        background-color: #f8d7da;
      }
      .output-section {
        border-left-color: #28a745;
        background-color: #d4edda;
      }
      .loading {
        border-left-color: #ffc107;
        background-color: #fff3cd;
      }
      .result-section pre {
        background-color: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
        margin: 0;
      }
      .result-section h2 {
        margin-top: 0;
        color: #333;
      }
      #submitBtn:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
      }
      .CodeMirror {
        height: 300px;
        border: 2px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Java Code Executor</h1>
      <p>Enter your Java class code below and submit to execute it:</p>

      <form id="javaForm">
        <div class="form-group">
          <label for="javaCode">Java Class Code:</label>
          <textarea
            id="javaCode"
            name="javaCode"
            placeholder="Enter your Java class code here..."
          ></textarea>
        </div>
        <button type="submit" id="submitBtn">Execute Java Code</button>
      </form>

      <div id="resultContainer" style="display: none; margin-top: 30px">
        <div class="result-section" id="resultSection">
          <!-- Results will be displayed here -->
        </div>
      </div>

      <div class="example">
        <h3>Example:</h3>
        <p>Try this simple Java class:</p>
        <pre><code>public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello from Java!");
        for (int i = 1; i <= 5; i++) {
            System.out.println("Count: " + i);
        }
    }
}</code></pre>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
    <script>
      var cmEditor = CodeMirror.fromTextArea(
        document.getElementById("javaCode"),
        {
          lineNumbers: true,
          mode: "text/x-java",
          indentUnit: 4,
          tabSize: 4,
          indentWithTabs: false,
          lineWrapping: true,
          matchBrackets: true,
          autofocus: true,
        }
      );
      cmEditor.setSize(null, 300);

      document
        .getElementById("javaForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const form = e.target;
          const javaCode = cmEditor ? cmEditor.getValue() : form.javaCode.value;
          const submitBtn = document.getElementById("submitBtn");
          const resultContainer = document.getElementById("resultContainer");
          const resultSection = document.getElementById("resultSection");

          if (!javaCode.trim()) {
            alert("Please enter Java code");
            return;
          }

          // Show loading state
          submitBtn.disabled = true;
          submitBtn.textContent = "Executing...";
          resultContainer.style.display = "block";
          resultSection.className = "result-section loading";
          resultSection.innerHTML =
            "<h2>⏳ Executing Java Code...</h2><p>Please wait while your code is being compiled and executed.</p>";

          try {
            const formData = new FormData();
            formData.append("javaCode", javaCode);

            const response = await fetch("/j2s", {
              method: "POST",
              headers: {
                "Content-Type": "application/json; charset=utf-8",
              },
              body: JSON.stringify({ javaCode }),
            });

            const result = await response.json();

            if (response.ok) {
              // Display results
              let html = "";

              if (result.output) {
                html += `
                            <div class="result-section output-section">
                                <h2>✅ Output</h2>
                                <pre>${result.output}</pre>
                            </div>
                        `;
              }

              if (result.error) {
                html += `
                            <div class="result-section error-section">
                                <h2>❌ Error</h2>
                                <pre>${result.error}</pre>
                            </div>
                        `;
              }

              if (!result.output && !result.error) {
                html += `
                            <div class="result-section">
                                <h2>ℹ️ Info</h2>
                                <p>Java code executed successfully with no output.</p>
                            </div>
                        `;
              }

              resultSection.innerHTML = html;
            } else {
              // Display error
              resultSection.className = "result-section error-section";
              resultSection.innerHTML = `
                        <h2>❌ Error</h2>
                        <p>${
                          result.error ||
                          "An error occurred while processing your request."
                        }</p>
                    `;
            }
          } catch (error) {
            // Display network error
            resultSection.className = "result-section error-section";
            resultSection.innerHTML = `
                    <h2>❌ Network Error</h2>
                    <p>Failed to connect to the server. Please try again.</p>
                `;
            console.error("Error:", error);
          } finally {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.textContent = "Execute Java Code";
          }
        });
    </script>
  </body>
</html>
